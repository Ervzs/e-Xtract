{% extends 'base.html' %}

{% block head %}
    <title>e-Xtract | Chatbot</title>
{% endblock %}

{% block body %}
<header>
    <div class="header-container">
        <h1 id="title_h1">e-Xtract</h1>
        <nav class="navbar">
            <ul>
                <li><a href=" {{ url_for('views.home') }}">Home</a></li>
                <li><a href=" {{ url_for('extract.chatbot') }}">Extract</a></li>
                <li><a href=" {{ url_for('routing.disposal_route') }}">Disposal Site Map</a></li>
            </ul>
        </nav>
    </div>
    <hr>
</header>

    <h1 id="chatbotTitle">Iko: the E-Waste Expert Chatbot</h1>
<hr>
<div id="container">
    <div id="chatbox">
        <div id="messages"></div>
        <div class="userInput">
            <input type="text" id="chatbotUserInput" placeholder="Let's take care of your e-waste!" />
            <button id="sendButton" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <div id="uploadSection">
        <h3>Upload E-Waste Image</h3>
        <input type="file" id="fileUpload" />
        <button id="uploadButton" onclick="uploadFile()">Upload</button>
    </div>
</div>

<script>
    function sendMessage() {
        let userMessage = document.getElementById("chatbotUserInput").value;
        let messagesDiv = document.getElementById("messages");
        messagesDiv.innerHTML += "<p><strong>You:</strong> " + userMessage + "</p>";
        document.getElementById("chatbotUserInput").value = "";

        fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: userMessage })
        })
        .then(response => response.json())
        .then(data => {
            messagesDiv.innerHTML += "<p><strong>Iko:</strong> " + data.response + "</p>";
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        })
        .catch(error => console.error("Error:", error));
    }

    function uploadFile() {
        let fileInput = document.getElementById("fileUpload");
        let file = fileInput.files[0];

        if (!file) {
            alert("Please select a file to upload.");
            return;
        }

        let formData = new FormData();
        formData.append("file", file);

        fetch("/upload", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            alert("File uploaded successfully!");
        })
        .catch(error => {
            console.error("Error uploading file:", error);
        });
    }
</script>
{% endblock %}
